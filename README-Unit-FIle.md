# CDK Erigon Service

This repository contains a systemd service file for managing the CDK Erigon application, allowing it to run automatically with a specified configuration and restart on failure.

## Service File Overview

The service file is designed for systemd, the default init system for many Linux distributions. Below is a brief overview of the key components.

### Service Configuration

- **Description**: A brief description of the service.
- **After**: Specifies that the service should start after the network is online.
- **Wants**: Ensures the network is online before starting the service.

### ExecStart

The command to start the CDK Erigon service, specifying the path to the executable and the configuration file:

```bash
ExecStart=/home/ubuntu/cdk-erigon/build/bin/cdk-erigon --config="/home/ubuntu/cdk-erigon/hermezconfig-cardona.yaml"
```

### WorkingDirectory

Sets the working directory for the service:

```bash
WorkingDirectory=/home/ubuntu/cdk-erigon
```

### Restart Policy

Automatically restarts the service on failure:

```bash
Restart=on-failure
```

### Environment

Sets the correct `PATH` for executing the command:

```bash
Environment=PATH=/usr/bin:/usr/local/bin
```

## Creating the Service File

To create the `cdk-erigon-cardona.service` file, follow these steps:

1. **Open a terminal**.

2. **Open the `vi` text editor** to create the service file:

   ```bash
   sudo vi /etc/systemd/system/cdk-erigon-cardona.service
   ```

3. **Paste the following configuration** into the file:

   ```ini
   [Unit]
   Description=CDK Erigon Service
   After=network-online.target
   Wants=network-online.target

   [Service]
   # Command to start the service with the path to the executable and configuration file
   ExecStart=/home/ubuntu/cdk-erigon/build/bin/cdk-erigon --config="/home/ubuntu/cdk-erigon/hermezconfig-cardona.yaml"
   # Set the working directory for the service
   WorkingDirectory=/home/ubuntu/cdk-erigon
   # Automatically restart the service if it fails
   Restart=on-failure
   # No user specified, runs as root
   # Ensure the correct PATH is set for executing the command
   Environment=PATH=/usr/bin:/usr/local/bin

   [Install]
   # Target to which this service should be installed, allowing it to run at the multi-user level
   WantedBy=multi-user.target
   ```

4. **Save and exit** the `vi` editor by pressing `Esc`, then typing `:wq` and hitting `Enter`.


5. **Reload the systemd daemon** to recognize the new service:

   ```bash
   sudo systemctl daemon-reload
   ```

6. **Start the service**:

   ```bash
   sudo systemctl start cdk-erigon-cardona.service
   ```

7. **(Optional) Enable the service to start on boot**:

   ```bash
   sudo systemctl enable cdk-erigon-cardona.service
   ```

## Management Commands

To manage the CDK Erigon service, you can use the following systemctl commands:

- **Start the service**:
  ```bash
  sudo systemctl start cdk-erigon-cardona.service
  ```

- **Check the status of the service**:
  ```bash
  sudo systemctl status cdk-erigon-cardona.service
  ```

- **Enable the service to start on boot** (if not already done):
  ```bash
  sudo systemctl enable cdk-erigon-cardona.service
  ```

- **View the logs generated by the service**:
  ```bash
  journalctl -u cdk-erigon-cardona.service
  ```

- **Stop the service**:
  ```bash
  sudo systemctl stop cdk-erigon-cardona.service
  ```

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
